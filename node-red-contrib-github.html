<!-- Config Node -->

<script type="text/javascript">
    RED.nodes.registerType('github-credentials',{
      defaults: {
        name: {value:"", required: true}
      },
      category: 'config',
      credentials: {
        token: {type: "password", required: true}
      },
      label: function() {
        return this.name;
      },
      exportable: false
    });
</script>


<script type="text/x-red" data-template-name="github-credentials">
    <div class="form-row" id="node-config-github-row">
    </div>

    <div class="form-row">
      <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="github.label.config.name"></span></label>
      <input type="text" id="node-config-input-name">
    </div>

    <div class="form-row">
      <label for="node-config-input-token"><i class="fa fa-key"></i> <span data-i18n="github.label.config.token"></span></label>
      <input type="text" id="node-config-input-token">
    </div>

</script>


<!-- REPO Node -->
<script type="text/javascript">

    function oneditprepare() {
        var defaults = this;

        $("#node-input-username").typedInput({default:'str', typeField: $("#node-input-usernameType"), types:['msg','flow','global','str']});
        $("#node-input-repository").typedInput({default:'str', typeField: $("#node-input-repositoryType"), types:['msg','flow','global','str']});

        $("#node-input-branch").typedInput({default:'str', typeField: $("#node-input-branchType"), types:['msg','flow','global','str']});
        $("#node-input-path").typedInput({default:'str', typeField: $("#node-input-pathType"),types:['msg','flow','global','str']});
        $("#node-input-contents").typedInput({default:'str', typeField: $("#node-input-contentsType"),types:['msg','flow','global','str']});


        function hideExtraActions(){
            $("#node-action-branch").hide();
            $("#node-action-path").hide();
            $("#node-action-contents").hide();
        }

        $("#node-input-action").change(function(){
            var so = $("#node-input-action option:selected").val();
            hideExtraActions();
            if(so=="show" || so=="delete"){
            }else if (so == "read" || so == "contents") {
                $("#node-action-branch").show();
                $("#node-action-path").show();
            }else if (so == "write") {
                $("#node-action-branch").show();
                $("#node-action-path").show();
                $("#node-action-contents").show();
            }
        });

    }

    function oneditsave(){
        var act = $("#node-input-action option:selected").val();
        if(act == "show" || act == "read"){
            this.outputs = 1;
        }else{
            this.outputs = 0;
        }
    }

    RED.nodes.registerType('github-repo',{
        defaults: {
          github: { type:"github-credentials",required:true},
          name: { value: ""},
          username: { required:true},
          usernameType: {value:"str"},
          repository: { required:true},
          repositoryType: {value:"str"},
          action: { value: "show", required:true},
          branch: { value:"master"},
          branchType: {valeu:"str"},
          path: {value:""},
          pathType: {value:""},
          contents: {value:"payload"},
          contentsType: {value:"msg"},
          outputs: {value: 1}
        },
        category: 'github',
        color:"#787878",
        inputs: 1,
        outputs: 1,
        icon: "github.png",
        label: function() {
            return this.name||"Repo";
        },
        oneditprepare: oneditprepare,
        oneditsave: oneditsave
    });
</script>

<script type="text/x-red" data-template-name="github-repo">

  <div class="form-row">
        <label for="node-input-github"><i class="fa fa-key"></i> <span data-i18n="github.label.github-id"></span></label>
        <input type="text" id="node-input-github">
  </div>
  <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name">
  </div>

  <div class="form-row">
      <label for="node-input-username"><i class="fa fa-user"></i><span data-i18n="github.label.username"></span></label>
      <input type="text" id="node-input-username" style="width:300px">
      <input type="hidden" id="node-input-usernameType">
  </div>

  <div class="form-row">
      <label for="node-input-repository"><i class="fa fa-book"></i><span data-i18n="github.label.repository"></span></label>
      <input type="text" id="node-input-repository" style="width:300px">
      <input type="hidden" id="node-input-repositoryType">
  </div>

  <div class="form-row">
      <label for="node-input-action"><i class="fa fa-wrench"></i>Action</label>
      <select type="text" id="node-input-action" style="display: inline-block; width: 250px; vertical-align: top;">
          <option value="show">Show info</option>
          <option value="contents">Get contents</option>
          <option value="read">Read file</option>
          <option value="write">Write to file</option>
          <option value="delete">Delete repo</option>
      </select>
      <div class="form-row" id="node-action-branch">
          <label for="node-input-branch">&nbsp;</label>Branch:<input type="text" style="width:208px" id="node-input-branch">
          <input type="hidden" id="node-input-branchType">
      </div>
      <div class="form-row" id="node-action-path">
          <label for="node-input-path">&nbsp;</label>Path:<input type="text" style="width:208px" id="node-input-path">
          <input type="hidden" id="node-input-pathType">
      </div>
      <div class="form-row" id="node-action-contents">
          <label for="node-input-contents">&nbsp;</label>Contents:<input type="text" style="width:208px" id="node-input-contents">
          <input type="hidden" id="node-input-contentsType">
      </div>
  </div>

</script>

<script type="text/x-red" data-help-name="github-repo">
    <p>A simple node to create a github</p>
</script>
